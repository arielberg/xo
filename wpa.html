<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello World PWA</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="A beautiful Hello World Progressive Web App">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Hello World PWA">
    
    <!-- Web App Manifest -->
    <link rel="icon" href="data:image/svg+xml,%3csvg width='32' height='32' xmlns='http://www.w3.org/2000/svg'%3e%3ccircle cx='16' cy='16' r='14' fill='%23667eea'/%3e%3ctext x='50%25' y='50%25' text-anchor='middle' dy='0.3em' fill='white' font-family='Arial' font-size='12' font-weight='bold'%3eHW%3c/text%3e%3c/svg%3e">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="data:application/manifest+json;base64,ewoKCSJuYW1lIjogIlNoYXJlUG9pbnQgVGl0bGUiLAoKCSJzaG9ydF9uYW1lIjogIlNQIFRpdGxlIiwKCgkiZGVzY3JpcHRpb24iOiAiVGhlIG9uZSBhbmQgb25seSBTaGFyZVBvaW50IFNpdGUgVGl0bGUgcHJvZ3JhbSEiLAoKCSJzdGFydF91cmwiOiAiaW5kZXguaHRtbCIsCgoJImljb25zIjogWwoKCQl7CgoJCQkic3JjIjogImFuZHJvaWQtY2hyb21lLTE0NHgxNDQucG5nIiwKCgkJCSJzaXplcyI6ICIxNDR4MTQ0IiwKCgkJCSJ0eXBlIjogImltYWdlXC9wbmciCgoJCX0sCgoJCXsKCgkJCSJzcmMiOiAiYW5kcm9pZC1jaHJvbWUtMTkyeDE5Mi5wbmciLAoKCQkJInNpemVzIjogIjE5MngxOTIiLAoKCQkJInR5cGUiOiAiaW1hZ2VcL3BuZyIKCgkJfSwKCgkJewoKCQkJInNyYyI6ICJhbmRyb2lkLWNocm9tZS0yNTZ4MjU2LnBuZyIsCgoJCQkic2l6ZXMiOiAiMjU2eDI1NiIsCgoJCQkidHlwZSI6ICJpbWFnZVwvcG5nIgoKCQl9CgoJXSwKCiAgICAiYmFja2dyb3VuZCI6ICIjZmYwMDAwIiwKCgkidGhlbWVfY29sb3IiOiAiI2ZmZmZmZiIsCgoJImRpc3BsYXkiOiAic3RhbmRhbG9uZSIKCn0=">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 500px;
            width: 90%;
            position: relative;
        }
        
        .pwa-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #4CAF50;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        h1 {
            color: #333;
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: fadeInUp 1s ease-out;
        }
        
        p {
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 2rem;
            animation: fadeInUp 1s ease-out 0.3s both;
        }
        
        .button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            animation: fadeInUp 1s ease-out 0.6s both;
            margin: 0.5rem;
        }
        
        .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        
        .button:active {
            transform: translateY(-1px);
        }
        
        .install-button {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            display: none;
        }
        
        .status {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 10px;
            color: #333;
            font-size: 0.9rem;
        }
        
        .share-instructions {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(255, 193, 7, 0.1);
            border-radius: 10px;
            color: #333;
            font-size: 0.9rem;
            border-left: 4px solid #FFC107;
        }
        
        .browser-hint {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(33, 150, 243, 0.1);
            border-radius: 10px;
            color: #333;
            font-size: 0.9rem;
            border-left: 4px solid #2196F3;
        }
        
        .debug-panel {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            color: #333;
            text-align: left;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .debug-panel h4 {
            margin: 0 0 0.5rem 0;
            color: #667eea;
            font-family: 'Segoe UI', sans-serif;
        }
        
        .debug-log {
            background: #f8f9fa;
            padding: 0.5rem;
            border-radius: 5px;
            margin-bottom: 0.5rem;
            border-left: 3px solid #28a745;
        }
        
        .debug-log.error {
            border-left-color: #dc3545;
            background: #fff5f5;
        }
        
        .debug-log.warning {
            border-left-color: #ffc107;
            background: #fffbf0;
        }
        
        .debug-toggle {
            background: rgba(0, 0, 0, 0.1);
            color: #333;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-top: 1rem;
        }
        
        .message {
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 10px;
            color: #333;
            font-weight: 500;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }
        
        .message.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .sparkle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #fff;
            border-radius: 50%;
            animation: sparkle 2s infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }
        
        .offline-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff4444;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 0.9rem;
            display: none;
            z-index: 1000;
        }
        
        .offline-indicator.online {
            background: #4CAF50;
        }
    </style>
</head>
<body>
    <div class="offline-indicator" id="offline-indicator">
        üì∂ Online
    </div>
    
    <div class="container">
        <div class="pwa-badge">PWA</div>
        <h1>Hello World!</h1>
        <p>Progressive Web App Edition</p>
        
        <button class="button" onclick="showMessage()">Click Me!</button>
        <button class="button install-button" id="install-button" onclick="installApp()">üì± Install App</button>
        
        <div class="status" id="status">
            ‚úÖ PWA Features Active
        </div>
        
        <div class="share-instructions">
            üì± <strong>Shared via WhatsApp?</strong><br>
            Tap "Open in Browser" for the best experience and to install this app!
        </div>
        
        <div class="browser-hint" id="browser-hint">
            üí° <strong>Install Tip:</strong><br>
            Look for the install button in your browser or the "Add to Home Screen" option in the menu.
        </div>
        
        <button class="debug-toggle" onclick="toggleDebug()">üêõ Toggle Debug Info</button>
        
        <div class="debug-panel" id="debug-panel" style="display: none;">
            <h4>üîß PWA Installation Debug</h4>
            <div id="debug-logs"></div>
        </div>
        
        <div id="message" class="message">
            üéâ This PWA works offline and can be installed on your device!
        </div>
    </div>

    <script>
        // Debug logging system
        const debugLogs = [];
        let debugVisible = false;
        
        function addDebugLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const log = { timestamp, message, type };
            debugLogs.push(log);
            
            console.log(`[PWA Debug ${timestamp}] ${message}`);
            
            if (debugVisible) {
                updateDebugPanel();
            }
        }
        
        function updateDebugPanel() {
            const debugLogsElement = document.getElementById('debug-logs');
            debugLogsElement.innerHTML = debugLogs.map(log => 
                `<div class="debug-log ${log.type}">
                    <strong>${log.timestamp}</strong> - ${log.message}
                </div>`
            ).join('');
            
            // Auto-scroll to bottom
            debugLogsElement.scrollTop = debugLogsElement.scrollHeight;
        }
        
        function toggleDebug() {
            debugVisible = !debugVisible;
            const panel = document.getElementById('debug-panel');
            panel.style.display = debugVisible ? 'block' : 'none';
            
            if (debugVisible) {
                updateDebugPanel();
            }
        }
        
        // Enhanced browser and environment detection
        function detectEnvironment() {
            const ua = navigator.userAgent;
            const vendor = navigator.vendor;
            
            // Browser detection
            let browser = 'Unknown';
            if (/Chrome/i.test(ua) && /Google Inc/i.test(vendor)) browser = 'Chrome';
            else if (/Firefox/i.test(ua)) browser = 'Firefox';
            else if (/Safari/i.test(ua) && /Apple/i.test(vendor)) browser = 'Safari';
            else if (/Edge/i.test(ua)) browser = 'Edge';
            else if (/Opera/i.test(ua)) browser = 'Opera';
            
            // Platform detection
            let platform = 'Unknown';
            if (/Android/i.test(ua)) platform = 'Android';
            else if (/iPhone|iPad|iPod/i.test(ua)) platform = 'iOS';
            else if (/Windows/i.test(ua)) platform = 'Windows';
            else if (/Mac/i.test(ua)) platform = 'macOS';
            else if (/Linux/i.test(ua)) platform = 'Linux';
            
            // In-app browser detection
            const isInApp = /wv|WebView|WhatsApp|Instagram|Facebook|Twitter|LinkedIn/i.test(ua);
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
            
            addDebugLog(`üåê Environment: ${browser} on ${platform}`);
            addDebugLog(`üì± In-app browser: ${isInApp ? 'Yes' : 'No'}`);
            addDebugLog(`üè† Standalone mode: ${isStandalone ? 'Yes' : 'No'}`);
            
            return { browser, platform, isInApp, isStandalone };
        }
        
        // Check PWA capabilities with hosting-aware logic
        function checkPWASupport() {
            const features = {
                serviceWorker: 'serviceWorker' in navigator,
                manifest: 'manifest' in document.createElement('link'),
                beforeInstallPrompt: 'onbeforeinstallprompt' in window,
                standalone: 'standalone' in navigator,
                pushManager: 'PushManager' in window,
                notifications: 'Notification' in window
            };
            
            const hostname = window.location.hostname;
            const isGitHubPages = hostname.includes('github.io');
            const isStaticHost = isGitHubPages || hostname.includes('netlify') || hostname.includes('vercel');
            
            addDebugLog('üîç PWA Feature Support:');
            Object.entries(features).forEach(([feature, supported]) => {
                let status = supported ? '‚úÖ' : '‚ùå';
                if (feature === 'serviceWorker' && isStaticHost) {
                    status = '‚ö†Ô∏è (limited on static hosts)';
                }
                addDebugLog(`  ${feature}: ${status}`);
            });
            
            if (isStaticHost) {
                addDebugLog('‚ÑπÔ∏è Running on static hosting - some features limited');
                addDebugLog('üí° PWA will still be installable and work great!');
            }
            
            return features;
        }
        // Service Worker Registration with external file
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                addDebugLog('üîß Attempting Service Worker registration...');
                
                navigator.serviceWorker.register('.js/sw.js')
                    .then(registration => {
                        addDebugLog('‚úÖ Service Worker registered successfully');
                        addDebugLog(`üìç SW Scope: ${registration.scope}`);
                        addDebugLog(`üìç SW Script URL: ${registration.active?.scriptURL || 'pending'}`);
                        
                        registration.addEventListener('updatefound', () => {
                            addDebugLog('üîÑ Service Worker update found');
                            const newWorker = registration.installing;
                            newWorker?.addEventListener('statechange', () => {
                                addDebugLog(`üîÑ SW State: ${newWorker.state}`);
                            });
                        });
                        
                        updateStatus('üîß Service Worker registered');
                    })
                    .catch(error => {
                        addDebugLog(`‚ùå SW registration failed: ${error.message}`, 'error');
                        addDebugLog('üí° Make sure sw.js file exists in the same directory', 'warning');
                        updateStatus('‚ö†Ô∏è Limited offline support');
                    });
            });
        } else {
            addDebugLog('‚ùå Service Worker not supported', 'error');
            updateStatus('üì± PWA ready (no offline support)');
        }
        
        // Detect if opened in WhatsApp in-app browser
        function detectWhatsAppBrowser() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            const isWhatsApp = /WhatsApp/i.test(userAgent);
            const isInAppBrowser = /wv|WebView/i.test(userAgent);
            
            if (isWhatsApp || isInAppBrowser) {
                document.getElementById('browser-hint').style.display = 'block';
                updateStatus('üì± Opened in in-app browser - open in main browser for install');
            }
        }
        
        // Install App functionality
        let deferredPrompt;
        const installButton = document.getElementById('install-button');
        
        window.addEventListener('beforeinstallprompt', (e) => {
            addDebugLog('üéØ beforeinstallprompt event fired');
            addDebugLog('üì± PWA installation prompt available');
            
            e.preventDefault();
            deferredPrompt = e;
            installButton.style.display = 'inline-block';
            
            addDebugLog('‚úÖ Install button shown');
        });
        
        window.addEventListener('appinstalled', (evt) => {
            addDebugLog('üéâ PWA was installed successfully!');
            updateStatus('üéâ App installed successfully!');
        });
        
        function installApp() {
            addDebugLog('üëÜ Install button clicked');
            
            if (deferredPrompt) {
                addDebugLog('üöÄ Showing install prompt...');
                deferredPrompt.prompt();
                
                deferredPrompt.userChoice.then((result) => {
                    addDebugLog(`üë§ User choice: ${result.outcome}`);
                    
                    if (result.outcome === 'accepted') {
                        addDebugLog('‚úÖ User accepted installation');
                        updateStatus('üì± App installed successfully!');
                    } else {
                        addDebugLog('‚ùå User dismissed installation', 'warning');
                    }
                    
                    deferredPrompt = null;
                    installButton.style.display = 'none';
                });
            } else {
                addDebugLog('‚ùå No install prompt available', 'error');
                addDebugLog('üí° Try: Add to Home Screen from browser menu', 'warning');
            }
        }
        
        // Online/Offline detection
        const offlineIndicator = document.getElementById('offline-indicator');
        
        function updateOnlineStatus() {
            if (navigator.onLine) {
                offlineIndicator.textContent = 'üì∂ Online';
                offlineIndicator.className = 'offline-indicator online';
            } else {
                offlineIndicator.textContent = 'üìµ Offline';
                offlineIndicator.className = 'offline-indicator';
            }
            offlineIndicator.style.display = 'block';
            setTimeout(() => {
                offlineIndicator.style.display = 'none';
            }, 3000);
        }
        
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        
        // Main app functionality
        function showMessage() {
            const message = document.getElementById('message');
            message.classList.add('show');
            createSparkles();
            updateStatus('üéâ Interactive features working!');
        }
        
        function updateStatus(text) {
            const status = document.getElementById('status');
            status.textContent = text;
            status.style.animation = 'fadeInUp 0.5s ease-out';
        }
        
        function createSparkles() {
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'sparkle';
                    sparkle.style.left = Math.random() * window.innerWidth + 'px';
                    sparkle.style.top = Math.random() * window.innerHeight + 'px';
                    sparkle.style.animationDelay = Math.random() * 2 + 's';
                    document.body.appendChild(sparkle);
                    
                    setTimeout(() => {
                        sparkle.remove();
                    }, 2000);
                }, i * 100);
            }
        }
        
        // Initial setup
        window.addEventListener('load', () => {
            setTimeout(createSparkles, 1000);
            updateOnlineStatus();
            
            // Run diagnostics
            addDebugLog('üîç Starting PWA diagnostics...');
            const env = detectEnvironment();
            const support = checkPWASupport();
            
            // Check installation status
            setTimeout(() => {
                detectWhatsAppBrowser();
                checkInstallability();
                
                // Final diagnostic summary
                setTimeout(() => {
                    addDebugLog('üìä Diagnostic Summary:');
                    if (env.isStandalone) {
                        addDebugLog('üéâ PWA is installed and running standalone!');
                    } else if (support.beforeInstallPrompt && !env.isInApp) {
                        addDebugLog('‚úÖ PWA is installable in this browser');
                    } else {
                        addDebugLog('‚ö†Ô∏è Installation may be limited in this environment', 'warning');
                        if (env.isInApp) {
                            addDebugLog('üí° Suggestion: Open in main browser for installation', 'info');
                        }
                    }
                }, 2000);
            }, 1000);
        });
        
        // Monitor display mode changes
        window.matchMedia('(display-mode: standalone)').addEventListener('change', (e) => {
            if (e.matches) {
                addDebugLog('üè† App switched to standalone mode');
                updateStatus('üì± Running as installed PWA!');
            } else {
                addDebugLog('üåê App switched to browser mode');
            }
        });
        
        // Detect if opened in WhatsApp in-app browser
        function detectWhatsAppBrowser() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            const isWhatsApp = /WhatsApp/i.test(userAgent);
            const isInAppBrowser = /wv|WebView/i.test(userAgent);
            
            if (isWhatsApp || isInAppBrowser) {
                document.getElementById('browser-hint').style.display = 'block';
                updateStatus('üì± Opened in in-app browser - open in main browser for install');
            }
        }
        
        // Enhanced install detection
        function checkInstallability() {
            // Check if already installed (standalone mode)
            if (window.matchMedia('(display-mode: standalone)').matches) {
                updateStatus('üì± Running as installed PWA!');
                document.querySelector('.share-instructions').style.display = 'none';
                document.getElementById('browser-hint').style.display = 'none';
                return true;
            }
            
            // Check if PWA install is supported
            if ('serviceWorker' in navigator && 'PushManager' in window) {
                setTimeout(() => {
                    if (!deferredPrompt) {
                        document.getElementById('browser-hint').style.display = 'block';
                    }
                }, 3000);
            }
            
            return false;
        }
        
        // Prevent zoom on iOS
        document.addEventListener('gesturestart', function (e) {
            e.preventDefault();
        });
    </script>
</body>
</html>